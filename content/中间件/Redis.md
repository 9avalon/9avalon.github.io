---
title : Redis
date : 2018-07-29 16:53:37
---

[TOC]

## Redisç®€å•ä»‹ç»

Redisæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„key-valueå†…å­˜æ•°æ®åº“ï¼Œç›®å‰ä¸šç•Œä¸»è¦ç”¨é€”æ˜¯æ‹¿æ¥åšç¼“å­˜ã€‚

### Redisç‰¹ç‚¹

1. å•è¿›ç¨‹å•çº¿ç¨‹ï¼Œä¸”æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› ä¸ºæ€§èƒ½éå¸¸é«˜ï¼Œå®˜æ–¹ç»™å‡ºçš„æ€§èƒ½æ•°æ®æ˜¯ï¼Œè¯»çš„é€Ÿåº¦æ˜¯110000æ¬¡/s,å†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚

2. åŸå­æ€§ï¼Œæ¯ä¸€ä¸ªæ“ä½œæœ‰ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚åŒæ—¶ï¼Œredisæ˜¯å•çº¿ç¨‹çš„

3. æ”¯æŒå¤šç§æ•°æ®ç»“æ„ï¼Œå¦‚Setå’ŒListç­‰ï¼Œè€Œmemcachedåªæ”¯æŒæœ€ç®€å•çš„ç®€å•å­—ç¬¦ä¸²ã€‚

### æœ€å¸¸ç”¨çš„å‘½ä»¤

#### è¿æ¥è¿œç¨‹æœåŠ¡å™¨

1.è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œéœ€è¦rediså®¢æˆ·ç«¯

```shell
redis-cli -h <ip> -p <port> -a <password>
```

ä¾‹å¦‚ï¼Œç°åœ¨è¦è¿æ¥åˆ°ä¸»æœºä¸º127.0.0.1ï¼Œç«¯å£ä¸º6379çš„redisæœåŠ¡å™¨ä¸Š

```shell
redis-cli -h 127.0.0.1 -p 6379
```

#### Key

æŸ¥æ‰¾key

```shell
KEYS egKey
KEYS egK*
KEYS *gK*
```

åˆ é™¤key

```shell
DEL key[key ...]
==> DEL egKey1
==> DEL egKey1 egKey2
```

#### String

è®¾ç½®keyå’Œkeyçš„è¿‡æœŸæ—¶é—´(æ¯«ç§’)

```shell
è¾“å…¥ SET egKey redis PX 10086
è¾“å‡º OK

è¾“å…¥ GET egKey
è¾“å‡º "redis"
```

æŸ¥çœ‹keyè¿‡æœŸæ—¶é—´

```shell
è¾“å…¥ TTL finance-test
è¾“å‡º 10069
```

è‡ªå¢ï¼Œå¦‚æœkeyå­˜åœ¨åˆ™åŠ ä¸€ï¼Œä¸å­˜åœ¨åˆ™å…ˆåˆå§‹åŒ–ä¸º0ï¼Œå†åŠ ä¸€ï¼Œå…·å¤‡åŸå­æ€§

```shell
INCR egIntKey
```

#### Hash

å¸¸ç”¨å‘½ä»¤: hget/hset

åº”ç”¨åœºæ™¯ï¼šå­˜å‚¨ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨æˆ·çš„IDï¼Œå§“åï¼Œå¹´é¾„å’Œç”Ÿæ—¥ï¼Œé€šè¿‡ç”¨æˆ·IDï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥è·å¾—è¯¥ç”¨æˆ·çš„å§“åæˆ–è€…å¹´æ—æˆ–è€…ç”Ÿæ—¥ã€‚

#### List

åº”ç”¨åœºæ™¯ï¼šlistçš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œå¦‚twitterçš„å…³æ³¨åˆ—è¡¨ï¼Œç²‰ä¸åˆ—è¡¨ï¼Œæ’è¡Œæ¦œç­‰ï¼Œéƒ½å¯ä»¥ç”¨Redisçš„listç»“æ„æ¥å®ç°ã€‚

å¸¸ç”¨å‘½ä»¤: lpush/rpush/lpop/rpop/lrange/lindex

#### Set

åº”ç”¨åœºæ™¯ï¼šsetä¸listç±»ä¼¼ï¼Œä½†ä¸åŒçš„æ˜¯setçš„æ’å…¥æ˜¯æ— åºçš„ï¼Œä½†æ˜¯setå¯ä»¥å»é‡ã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚

å¸¸ç”¨å‘½ä»¤ï¼šsadd/spop/smembers/sunion

æ›´å¤šå‘½ä»¤ç”¨æ³•ï¼š[å‘½ä»¤å‚æ•°](http://doc.redisfans.com/index.html)

## å¸¸è§ç”¨é€”

### ç¼“å­˜

æ€§èƒ½å“è¶Šï¼Œçº¯å†…å­˜æ“ä½œï¼Œéå¸¸é€‚åˆç”¨æ¥åšå†…å­˜æ•°æ®åº“ã€‚

### åˆ†å¸ƒå¼é”

1.é€šè¿‡å‘½ä»¤SETNXå’ŒEXPIREç»„åˆï¼Œå¯ä»¥å®ç°åˆ†å¸ƒå¼é”ã€‚

```shell
SETNX key value
```

å°† key çš„å€¼è®¾ä¸º value ï¼Œå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨ã€‚

è‹¥ç»™å®šçš„ key å·²ç»å­˜åœ¨ï¼Œåˆ™ SETNX ä¸åšä»»ä½•åŠ¨ä½œã€‚

è¿”å›å€¼:

è®¾ç½®æˆåŠŸï¼Œè¿”å› 1 ã€‚

è®¾ç½®å¤±è´¥ï¼Œè¿”å› 0 ã€‚


é£é™©ç‚¹ï¼šå› ä¸ºSETNXå’ŒEXPIREéœ€è¦è¿›è¡Œç»„åˆï¼Œå¯¼è‡´æ— æ³•ä¿è¯å…¶åŸå­æ€§ï¼Œå¦‚æœåœ¨SETNXåï¼Œç¨‹åºè¢«æ„å¤–åœ°killæ‰ï¼Œä¼šå¯¼è‡´å½“å‰çš„é”æ— è¿‡æœŸæ—¶é—´ï¼Œè¯·æ±‚åˆ™ä¼šè¢«ä¸€ç›´é˜»å¡ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨åŠ é”å‰æ£€æŸ¥é”æ˜¯å¦å­˜åœ¨ï¼Œä¸”åˆ¤æ–­å…¶æ˜¯å¦æœ‰è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ— è¿‡æœŸæ—¶é—´ï¼Œåˆ™è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¸”æ‹’ç»è¯¥æ¬¡è¯·æ±‚ã€‚

20190122æ›´æ–°ï¼Œä¸Šé¢æåˆ°çš„SETNXå’ŒEXPIREä¸æ˜¯åŸå­æ€§çš„é—®é¢˜ï¼Œå·²ç»å¯ä»¥è§£å†³ã€‚

```sh
SET resource_name my_random_value NX PX 30000
```

ä¸‹å›¾æ˜¯é«˜ç‰ˆæœ¬çš„Jediså®ç°

![Jediså®ç°](https://ws1.sinaimg.cn/large/005H7Wvygy1fzeo1r256dj30hp024mx9.jpg)

#### æ‰©å±•

ä¸Šé¢å†™çš„ï¼Œåªæ˜¯å•æœºä¸‹çš„Rediså®ç°åˆ†å¸ƒå¼é”ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå•æœºæ˜¯å¾ˆå±é™©çš„ï¼Œä¸€æ—¦å•å°Rediså®•æœºï¼Œåˆ™åˆ†å¸ƒå¼é”åˆ™ä¼šå¤±æ•ˆï¼Œå› æ­¤ä¸€èˆ¬ä¼šéƒ¨ç½²å¤šå°åˆ†å¸ƒå¼æœºå™¨ï¼Œè€ŒRediså¹¶ä¸å…·å¤‡å¦‚ZKå¼ºä¸€è‡´æ€§å’Œç‰¹æ€§ã€‚è€ƒè™‘ä½¿ç”¨ä¸»ä»çš„æ–¹å¼ï¼Œä½†å› ä¸ºä¸»ä»åŒæ­¥æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå¹¶ä¸èƒ½ä¿è¯keyçš„ä¸€è‡´æ€§ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒRedisçš„ä½œè€…å‰”é™¤äº†RedLockç®—æ³•ã€‚å…·ä½“å¯ä»¥äº†è§£ä¸€ä¸‹ã€‚

å‚è€ƒèµ„æ–™ï¼š

[åŸºäºRedisçš„åˆ†å¸ƒå¼é”åˆ°åº•å®‰å…¨å—ï¼ˆä¸Šï¼‰](https://mp.weixin.qq.com/s/JTsJCDuasgIJ0j95K8Ay8w)

[åŸºäºRedisçš„åˆ†å¸ƒå¼é”åˆ°åº•å®‰å…¨å—ï¼ˆä¸‹ï¼‰](https://mp.weixin.qq.com/s/4CUe7OpM6y1kQRK8TOC_qQ)

### æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰

åˆ©ç”¨Redisçš„å‘å¸ƒè®¢é˜…åŠŸèƒ½

ä¸‹å›¾å±•ç¤ºäº†é¢‘é“ channel1 ï¼Œ ä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯ â€”â€” client2 ã€ client5 å’Œ client1 ä¹‹é—´çš„å…³ç³»

![è®¢é˜…](http://www.runoob.com/wp-content/uploads/2014/11/pubsub1.png)

å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡ PUBLISH å‘½ä»¤å‘é€ç»™é¢‘é“ channel1 æ—¶ï¼Œ è¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ï¼š

![å‘é€æ¶ˆæ¯](http://www.runoob.com/wp-content/uploads/2014/11/pubsub2.png)

rediså®ç°çš„mqåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå¯ç®¡ç†å‹ä¼šæ¯”è¾ƒå·®ã€‚

ç›®å‰å…¬å¸è€é¡¹ç›®ç”¨çš„æ˜¯è‡ªç ”çš„redisä½œä¸ºmqï¼Œæ–°é¡¹ç›®åˆ™è½¬ç”¨rocketmqã€‚

## åˆ†å¸ƒå¼

codisï¼Œæœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥çœ‹çœ‹

## å…¬å¸Redisç»„å»ºçš„ä½¿ç”¨

wikiåœ°å€.....

## æŸ¥æ‰¾å¤§KEY

```shell

redis-cli --bigkeys

./redis-cli -p 9803 --bigkeys
# Scanning the entire keyspace to find biggest keys as well as
# average sizes per key type. You can use -i 0.1 to sleep 0.1 sec
# per 100 SCAN commands (not usually needed).
[00.00%] Biggest string found so far 'MQS:700000-restful_srv_log-600000-run' with 9 bytes
[00.00%] Biggest list found so far 'mq:msg_ack_queue-600000-uat' with 27371754 items
-------- summary -------
Sampled 71 keys in the keyspace!
Total key length in bytes is 2747 (avg len 38.69)
Biggest string found 'MQS:700000-restful_srv_log-600000-run' has 9 bytes
Biggest list found 'mq:msg_ack_queue-600000-uat' has 27371754 items
53 strings with 239 bytes (74.65% of keys, avg size 4.51)
18 lists with 27376047 items (25.35% of keys, avg size 1520891.50)
0 sets with 0 members (00.00% of keys, avg size 0.00)
0 hashs with 0 fields (00.00% of keys, avg size 0.00)
0 zsets with 0 members (00.00% of keys, avg size 0.00)
```
