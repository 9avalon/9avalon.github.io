
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../static/favicon.ico">

    <title>spring mvc - 9avalon wiki</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/jumbotron-narrow.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
	<link href="../static/css/tango.css" rel="stylesheet">
</head>

<body>

<div class="container">
	<ol class="breadcrumb">	
		<li><a href="/">Home</a></li><li><a href="/#Java">Java</a></li><li class="active">spring mvc</li>
    </ol>
	
    <div class="header clearfix">
        <nav>
            <ul class="nav nav-pills pull-right">
            </ul>
        </nav>
        <h3 class="text-muted">spring mvc</h3>
    </div>

    <div class="row wiki-main">
		<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#spring-mvc">搭建Spring MVC</a></li>
<li><a href="#_1">上传文件的配置</a></li>
</ul>
</div>
<h3 id="spring-mvc">搭建Spring MVC</h3>
<ul>
<li>准备jar包，其实Spring的包里面已经整合了springmvc，直接全部拷进去即可</li>
<li>创建web工程。</li>
<li>引入包</li>
<li>配置web.xml</li>
</ul>
<div class="hlcode"><pre>  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springmvc<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
          <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
          <span class="c">&lt;!-- 在这里配置springmvc在src里面的位置  --&gt;</span>
          <span class="nt">&lt;param-value&gt;</span>classpath:config/spring/springmvc.xml<span class="nt">&lt;/param-value&gt;</span>
      <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  <span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>springmvc<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="c">&lt;!--  restful风格 --&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/servlet-mapping&gt;</span>    
</pre></div>


<ul>
<li>配置好之后，新建springmvc配置文件，一般我会在src的根目录下建立一个config文件夹，专门用来存放框架的配置文件。</li>
</ul>
<div class="hlcode"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>   
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>  
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> 
     <span class="na">xmlns:mvc=</span><span class="s">&quot;http://www.springframework.org/schema/mvc&quot;</span>
     <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>  
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans </span>
<span class="s">     http://www.springframework.org/schema/beans/spring-beans-3.0.xsd </span>
<span class="s">     http://www.springframework.org/schema/context </span>
<span class="s">     http://www.springframework.org/schema/context/spring-context-3.0.xsd</span>
<span class="s">     http://www.springframework.org/schema/mvc</span>
<span class="s">     http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd&quot;</span><span class="nt">&gt;</span>   

  <span class="c">&lt;!-- 组件扫描handler --&gt;</span>
  <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;org.daxiang.controller&quot;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>   

  <span class="c">&lt;!-- 使用mvc:annotation-driven代替上面注解适配和映射器 --&gt;</span>
  <span class="nt">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span>

  <span class="c">&lt;!-- 视图解析器 --&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;prefix&quot;</span> <span class="na">value=</span><span class="s">&quot;/jsps/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;suffix&quot;</span> <span class="na">value=</span><span class="s">&quot;.jsp&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

  <span class="c">&lt;!-- 文件上传 --&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;multipartResolver&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- 设置上传文件的大小最多大小50mb --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxUploadSize&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;value&gt;</span>5242880<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>

  <span class="c">&lt;!-- 静态资源解析 --&gt;</span>
  <span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">&quot;/js/&quot;</span> <span class="na">mapping=</span><span class="s">&quot;/js/**&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">&quot;/css/&quot;</span> <span class="na">mapping=</span><span class="s">&quot;/css/**&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">&quot;/images/&quot;</span> <span class="na">mapping=</span><span class="s">&quot;/images/**&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">&quot;/fonts/&quot;</span> <span class="na">mapping=</span><span class="s">&quot;/fonts/**&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>如果使用的是restful风格的api，则需要在spinrgmvc的配置文件中加上
    <mvc:default-servlet-handler/>
不加的话会导致首页跳转不到index.jsp。</p>
<h3 id="_1">上传文件的配置</h3>
<p>第一步是要在springmvc的配置文件里面写上这个</p>
<div class="hlcode"><pre><span class="c">&lt;!-- 文件上传 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;multipartResolver&quot;</span>           <span class="na">class=</span><span class="s">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver &quot;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- 设置上传文件的大小最多大小50mb --&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;maxUploadSize&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value&gt;</span>5242880<span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<p>第二步是上传的表单form中，需要加入这个enctype="multipart/form-data"</p>
<div class="hlcode"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;&lt;c:url value=&#39;/test/upload&#39;/&gt;&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="nt">&gt;</span>
</pre></div>


<p>第三步是后台的接收，关键在于接收的数组，如果多个同name的文件上传，文件就会放到这个数组里面，然后如果某个文件没有上传，也会以0字节的大小来占位</p>
<div class="hlcode"><pre><span class="cm">/**</span>
<span class="cm">* 测试上传</span>
<span class="cm">* @return</span>
<span class="cm">*/</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/upload&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@ResponseBody</span> <span class="n">String</span> <span class="n">testupload</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span>       <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&quot;multipartFiles&quot;</span><span class="o">)</span> <span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">multipartFiles</span><span class="o">){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">multipartFiles</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
    </div>

    <footer class="footer">
        <p style="font-size: 12px">Copyright © 2016 . Powered by Simiki. Theme by 9avalon</p>
    </footer>

</div> <!-- /container -->

</body>
</html>