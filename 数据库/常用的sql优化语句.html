
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../static/favicon.ico">

    <title>sql优化 - 9avalon wiki</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/jumbotron-narrow.css" rel="stylesheet">
    <link href="../static/css/style.css" rel="stylesheet">
	<link href="../static/css/tango.css" rel="stylesheet">
</head>

<body>

<div class="container">
	<ol class="breadcrumb">	
		<li><a href="/">Home</a></li><li><a href="/#数据库">数据库</a></li><li class="active">sql优化</li>
    </ol>
	
    <div class="header clearfix">
        <nav>
            <ul class="nav nav-pills pull-right">
            </ul>
        </nav>
        <h3 class="text-muted">sql优化</h3>
    </div>

    <div class="row wiki-main">
		<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#sql">怎么给sql语句做优化呢？</a><ul>
<li><a href="#_1">给列加索引</a></li>
<li><a href="#whereis-null-is-not-null">避免在where字句中使用is null 或者 is not null</a></li>
<li><a href="#where">避免在where字句中使用！=或者&lt;&gt;操作符</a></li>
<li><a href="#whereor">避免在where字句中使用or来链接条件</a></li>
<li><a href="#innot-in">少用 in或者not in</a></li>
<li><a href="#like">注意like通配符的使用</a></li>
</ul>
</li>
</ul>
</div>
<p>总结了一下，优化sql的关键在于加索引，然后尽量让数据查询都能使用到索引，如乱使用like或者or会导致数据库不使用索引查询，然后查询速度当然就会慢很多了</p>
<h4 id="sql">怎么给sql语句做优化呢？</h4>
<h5 id="_1">给列加索引</h5>
<p>首先，最常用的当然还是加索引，索引能明显的提高查询数据的速度。</p>
<h5 id="whereis-null-is-not-null">避免在where字句中使用is null 或者 is not null</h5>
<div class="hlcode"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">uname</span> <span class="k">is</span> <span class="k">null</span><span class="p">;</span>
</pre></div>


<p>在这种情况下，就算给uname设置了索引，查询分析器也不会去使用，因此效率会底下，一般做法是给定一个默认值从而不让数据为空。</p>
<h5 id="where">避免在where字句中使用！=或者&lt;&gt;操作符</h5>
<p>同上，此种写法索引也不会生效，但是对于&lt;、 &lt;=、 &gt;=、 =、 &gt;这些倒是会有效果。建议写法为用union all连接</p>
<div class="hlcode"><pre><span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">0</span>  
<span class="k">union</span> <span class="k">all</span>  
<span class="k">select</span> <span class="n">name</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">;</span>
</pre></div>


<h5 id="whereor">避免在where字句中使用or来链接条件</h5>
<div class="hlcode"><pre><span class="k">select</span>  <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">col1</span><span class="o">=?</span> <span class="k">or</span> <span class="n">col2</span><span class="o">=?</span><span class="p">;</span>
</pre></div>


<p>这种情况下我们可以写</p>
<div class="hlcode"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">col1</span><span class="o">=?</span>
<span class="k">union</span> <span class="k">all</span> 
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">col2</span><span class="o">=?</span><span class="p">;</span>
</pre></div>


<h5 id="innot-in">少用 in或者not in</h5>
<p>in和not in我在hql中用得很多。</p>
<div class="hlcode"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">col1</span> <span class="k">in</span> <span class="p">(</span><span class="k">sql</span><span class="p">);</span>
</pre></div>


<p>这时候可以考虑用between来替代(对于已知)</p>
<div class="hlcode"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">table</span> <span class="k">where</span> <span class="n">col1</span> <span class="k">between</span> <span class="o">?</span> <span class="k">and</span> <span class="o">?</span>
</pre></div>


<h5 id="like">注意like通配符的使用</h5>
<div class="hlcode"><pre><span class="c1">//下面两种都会很慢，因为前面是通配符</span>
<span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">table</span> <span class="n">where</span> <span class="n">name</span> <span class="n">like</span><span class="o">=</span><span class="err">&#39;</span><span class="o">%</span><span class="n">happy</span><span class="o">%</span><span class="err">&#39;</span>  
<span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">table</span> <span class="n">where</span> <span class="n">name</span> <span class="n">like</span><span class="o">=</span><span class="err">&#39;</span><span class="o">%</span><span class="n">happy</span><span class="err">&#39;</span>

<span class="c1">//这种会快很多，因为使用到了索引</span>
<span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">table</span> <span class="n">where</span> <span class="n">name</span> <span class="n">like</span><span class="o">=</span><span class="err">&#39;</span><span class="n">happy</span><span class="o">%</span><span class="err">&#39;</span>
</pre></div>
    </div>

    <footer class="footer">
        <p style="font-size: 12px">Copyright © 2016 . Powered by Simiki. Theme by 9avalon</p>
    </footer>

</div> <!-- /container -->

</body>
</html>